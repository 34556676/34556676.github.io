"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8987],{7224:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"\u6570\u636e\u5e93/mysql/mysql\u5168\u91cf\u5f02\u5730\u5907\u4efd","title":"mysql\u5168\u91cf\u5f02\u5730\u5907\u4efd","description":"1\u3001\u5b89\u88c5expect","source":"@site/docs/\u6570\u636e\u5e93/mysql/mysql\u5168\u91cf\u5f02\u5730\u5907\u4efd.md","sourceDirName":"\u6570\u636e\u5e93/mysql","slug":"/\u6570\u636e\u5e93/mysql/mysql\u5168\u91cf\u5f02\u5730\u5907\u4efd","permalink":"/docs/\u6570\u636e\u5e93/mysql/mysql\u5168\u91cf\u5f02\u5730\u5907\u4efd","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u6570\u636e\u5e93/mysql/mysql\u5168\u91cf\u5f02\u5730\u5907\u4efd.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"my.conf","permalink":"/docs/\u6570\u636e\u5e93/mysql/my.conf"},"next":{"title":"mysql\u5728win\u4e0b\u5b9a\u65f6\u5907\u4efd","permalink":"/docs/\u6570\u636e\u5e93/mysql/mysql\u5728win\u4e0b\u5b9a\u65f6\u5907\u4efd"}}');var t=r(4848),a=r(8453);const d={},c=void 0,i={},l=[];function o(n){const e={code:"code",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"1\u3001\u5b89\u88c5expect"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"yum -y install expect\n"})}),"\n",(0,t.jsx)(e.p,{children:"2\u3001\u5907\u4efd\u811a\u672c vi backup.sh \u3001chmod +x backup.sh"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'#!/bin/bash\r\n#adonis \u8046\u542c\u96e8\r\n\r\n#\u5907\u4efd\u6587\u4ef6\u540d\u65f6\u95f4\r\nbkdate=$(date +%Y%m%d%H%M%S)\r\n\r\n#\u5907\u4efd\u7684\u6587\u4ef6\u540d\uff1b\u4f8b\u5982\uff1a databak20210918101654\r\nbakFileName=databak$bkdate\r\n\r\n#\u5b58\u653e\u5907\u4efd\u6570\u636e\u7684\u670d\u52a1\u5668\u5bc6\u7801\r\npassword=\'lsgz3edc#EDC\'\r\n\r\n#\u672c\u673a\u5907\u4efd\u5b58\u653e\u76ee\u5f55\r\nbackupdir=/data/backup\r\n\r\n#\u5220\u966415\u5929\u4ee5\u524d\u7684\u5907\u4efd\r\nday=15\r\n\r\nif [ ! -d $backupdir ]; then\r\n\r\n        mkdir -p $backupdir\r\nfi\r\n\r\nfind $backupdir -type f -mtime +$day -exec rm -rf {} \\; > /dev/null 2>&1\r\n\r\n/data/mysql/bin/mysqldump --defaults-file=/etc/my.cnf  -uroot -pw1ses0ft  --all-databases --lock-all-tables  --routines --triggers --events --flush-logs --set-gtid-purged=OFF  | gzip > ${backupdir}/$bakFileName.sql.gz\r\n\r\ncd $backupdir\r\n\r\n/usr/bin/expect <<-EOF\r\n\r\nspawn scp -P 52225  -r ${backupdir}/$bakFileName.sql.gz root@59.213.129.163:/data/mysql_backup\r\n\r\nset timeout 300\r\n\r\nexpect {\r\n"(yes/no)?" {\r\n   send "yes\\n"\r\n   expect "*assword:" { send "$password\\r"}\r\n  }\r\n  "*assword:" {\r\n   send "$password\\n"\r\n  }\r\n}\r\n\r\nexpect eof\r\n\r\nEOF\r\n\n'})}),"\n",(0,t.jsx)(e.p,{children:"3\u3001\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u5929\u665a\u4e0a\u51cc\u66681\u70b9\u6267\u884c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"0 1 * * * /data/backup.sh\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u4e0b\u65b9\u91c7\u7528\u7684\u662fssh\u5bc6\u94a5\u5bf9\u5f02\u5730\u4f20\u8f93\u5907\u4efd\uff08\u6ce8\u610fmysqldump\u7684\u5bc6\u7801\uff09\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'#!/bin/bash\r\n\r\nbkdate=$(date +%Y%m%d%H%M%S)\r\n\r\nbakFileName=databak$bkdate\r\n\r\n\r\nbackupdir=/data/backup\r\n\r\nif [ ! -d $backupdir ]; then\r\n\r\n\tmkdir -p $backupdir\r\nfi\r\n\r\n#\u5220\u96647\u5929\u4ee5\u524d\u7684\u5907\u4efd\r\nday=7\r\n\r\nfind $backupdir -type f -mtime +$day -exec rm -rf {} \\; > /dev/null 2>&1\r\n\r\n/data/mysql/bin/mysqldump --defaults-file=/etc/my.cnf  -uroot -pw1ses0ft  --all-databases --lock-all-tables  --routines --triggers --events --flush-logs --set-gtid-purged=OFF  | gzip > ${backupdir}/$bakFileName.sql.gz\r\n\r\ncd $backupdir\r\n\r\nscp -P 52225  -r ${backupdir}/$bakFileName.sql.gz root@59.213.129.163:/data/mysql_backup\r\n\r\n\r\nssh root@59.213.129.163 -p 52225 "find /data/mysql_backup -type f -iname "*.sql.gz" -mtime +$day -exec rm -rf {} \\;"\r\n\n'})})]})}function p(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(o,{...n})}):o(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>d,x:()=>c});var s=r(6540);const t={},a=s.createContext(t);function d(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:d(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);