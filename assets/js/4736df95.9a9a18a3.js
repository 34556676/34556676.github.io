"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8011],{1773:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>l,default:()=>d,frontMatter:()=>t,metadata:()=>c,toc:()=>i});const c=JSON.parse('{"id":"\u6570\u636e\u5e93/mysql/xtrabackup\u5907\u4efd\u4e0e\u6062\u590d","title":"xtrabackup\u5907\u4efd\u4e0e\u6062\u590d","description":"1\u3001xtrabackup\u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d","source":"@site/docs/\u6570\u636e\u5e93/mysql/xtrabackup\u5907\u4efd\u4e0e\u6062\u590d.md","sourceDirName":"\u6570\u636e\u5e93/mysql","slug":"/\u6570\u636e\u5e93/mysql/xtrabackup\u5907\u4efd\u4e0e\u6062\u590d","permalink":"/docs/\u6570\u636e\u5e93/mysql/xtrabackup\u5907\u4efd\u4e0e\u6062\u590d","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u6570\u636e\u5e93/mysql/xtrabackup\u5907\u4efd\u4e0e\u6062\u590d.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"userparameter_mysql.conf","permalink":"/docs/\u6570\u636e\u5e93/mysql/userparameter_mysql.conf"},"next":{"title":"\u4fee\u6539mysql\u63d0\u793a\u7b26\u7684\u65b9\u5f0f","permalink":"/docs/\u6570\u636e\u5e93/mysql/\u4fee\u6539mysql\u63d0\u793a\u7b26\u7684\u65b9\u5f0f"}}');var a=n(4848),s=n(8453);const t={},l=void 0,p={},i=[{value:"<strong>1\u3001xtrabackup\u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d</strong>",id:"1xtrabackup\u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d",level:3},{value:"<strong>2\u3001xtrabackup\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d</strong>",id:"2xtrabackup\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d",level:3},{value:"3\u3001xtrabackup\u5dee\u5f02\u5907\u4efd\u4e0e\u6062\u590d",id:"3xtrabackup\u5dee\u5f02\u5907\u4efd\u4e0e\u6062\u590d",level:3},{value:"1\u3001\u5168\u91cf\u5907\u4efd\u811a\u672c",id:"1\u5168\u91cf\u5907\u4efd\u811a\u672c",level:3},{value:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1\u6267\u884c\u811a\u672c",id:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1\u6267\u884c\u811a\u672c",level:3},{value:"Xtrabackup\u589e\u91cf\u5907\u4efd\u811a\u672c\uff1a",id:"xtrabackup\u589e\u91cf\u5907\u4efd\u811a\u672c",level:2},{value:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1\uff1a",id:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1",level:3}];function o(r){const e={code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...r.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h3,{id:"1xtrabackup\u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d",children:(0,a.jsx)(e.strong,{children:"1\u3001xtrabackup\u5168\u91cf\u5907\u4efd\u4e0e\u6062\u590d"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.em,{children:(0,a.jsx)(e.strong,{children:"*\u6ce8\u610f\uff1a\u5907\u4efd\u65f6\u9700\u542f\u52a8MySQL,\u6062\u590d\u65f6\u9700\u5173\u95edMySQL,\u6e05\u7a7amysql\u6570\u636e\u76ee\u5f55\u4e14\u4e0d\u80fd\u91cd\u65b0\u521d\u59cb\u5316,\u6062\u590d\u6570\u636e\u540e\u5e94\u8be5\u7acb\u5373\u8fdb\u884c\u4e00\u6b21\u5b8c\u5168\u5907\u4efd*"})})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u5907\u4efd\uff1a\r\ninnobackupex --user=DBUSER --password=DBUSERPASS --defaults-file=/etc/my.cnf /path/to/BACKUP-DIR/\r\n\r\n\u6062\u590d\uff1a\r\ninnobackupex --apply-log /backups/2018-07-30_11-04-55/\r\ninnobackupex --copy-back --defaults-file=/etc/my.cnf  /backups/2018-07-30_11-04-55/\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5f53\u6570\u636e\u6062\u590d\u81f3DATADIR\u76ee\u5f55\u4ee5\u540e\uff0c\u8fd8\u9700\u8981\u786e\u4fdd\u6240\u6709\u7684\u6570\u636e\u6587\u4ef6\u7684\u5c5e\u4e3b\u548c\u5c5e\u7ec4\u5747\u4e3a\u6b63\u786e\u7684\u7528\u6237\uff0c\u5982mysql\uff0c\u5426\u5219\uff0c\u5728\u542f\u52a8mysqld\u4e4b\u524d\u8fd8\u9700\u8981\u4e8b\u5148\u4fee\u6539\u6570\u636e\u6587\u4ef6\u7684\u5c5e\u4e3b\u548c\u5c5e\u7ec4\u3002\u5982\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"# chown -R mysql.mysql /mydata/data/\n"})}),"\n",(0,a.jsx)(e.h3,{id:"2xtrabackup\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d",children:(0,a.jsx)(e.strong,{children:"2\u3001xtrabackup\u589e\u91cf\u5907\u4efd\u4e0e\u6062\u590d"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u5907\u4efd\uff1a\r\ninnobackupex --user=DBUSER --password=DBUSERPASS --incremental=backups/2018-07-30_11-01-37/ --incremental-basedir=\u4e0a\u6b21\u5907\u4efd\u7684\u76ee\u5f55\r\n\r\n\r\n\u6062\u590d\uff1a innobackupex --copy-back /backups/2018-07-30_11-01-37/\n"})}),"\n",(0,a.jsx)(e.h3,{id:"3xtrabackup\u5dee\u5f02\u5907\u4efd\u4e0e\u6062\u590d",children:"3\u3001xtrabackup\u5dee\u5f02\u5907\u4efd\u4e0e\u6062\u590d"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\u9996\u5148\u5b8c\u6574\u5907\u4efd\uff1ainnobackupex --user=DBUSER --password=DBUSERPASS --defaults-file=/etc/my.cnf /path/to/BACKUP-DIR/\r\n\r\n\u7b2c\u4e09\u5929\uff1ainnobackupex --user=DBUSER --password=DBUSERPASS --incremental=backups --incremental-basedir=\u57fa\u4e8e\u7b2c\u4e00\u6b21\u7684\u5b8c\u6574\u5907\u4efd\r\n\r\n\u7b2c\u5341\u4e94\u5929\uff1ainnobackupex --user=DBUSER --password=DBUSERPASS --incremental=backups --incremental-basedir=\u57fa\u4e8e\u7b2c\u4e00\u6b21\u7684\u5b8c\u6574\u5907\u4efd\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5b89\u88c5"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"yum -y install rsync\r\n\r\nwget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.4/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm\r\n\r\nrpm -ivh percona-xtrabackup-24-2.4.4-1.el7.x86_64.rpm\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u5907\u4efd\u7b56\u7565"}),"\n",(0,a.jsx)(e.h3,{id:"1\u5168\u91cf\u5907\u4efd\u811a\u672c",children:"1\u3001\u5168\u91cf\u5907\u4efd\u811a\u672c"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'[root@centos7 ~]# cat fullback_mysql.sh\r\n#!/bin/bash\r\nuser=root\r\npasswd=centos\r\nDATE=`date +"%Y/%W/%w/%F-%T"` # \u5b9a\u4e49\u5907\u4efd\u76ee\u5f55\u65e5\u671f\uff0c\u521b\u5efa\u7684\u76ee\u5f55\u6709\u5e74\u3001\u6708\u3001\u5468\u5206\u522b\u7684\u76ee\u5f55\u53ca\u5168\u91cf\u65e5\u671f\u7684\u76ee\u5f55\r\nfullback=/backup/full/$DATE # \u5b9a\u4e49\u5168\u91cf\u5907\u4efd\u76ee\u5f55\r\n[ ! -d $fullback ] && mkdir $fullback -p  # \u5224\u65ad\u76ee\u5f55\u4e0d\u5b58\u5728\u4e3a\u771f\uff0c\u4e3a\u771f\u5c31\u521b\u5efa\u76ee\u5f55\r\nxtrabackup  --user=$user --password=$passwd   --backup  --target-dir=$fullback &> /tmp/mysql # \u8fdb\u884c\u5168\u91cf\u5907\u4efd\uff0c\u5e76\u5c06\u5907\u4efd\u4fe1\u606f\u6307\u5b9a\u5230\u6587\u4ef6\u4e2d\r\negrep ".* Backup created in directory.*" /tmp/mysql >> /backup/full/complete.info  # \u8fc7\u6ee4\u51fa\u5f53\u524d\u521b\u5efa\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u65b9\u4fbf\u5728\u589e\u91cf\u65f6\u53ef\u4ee5\u786e\u5b9a\u4e0a\u4e00\u7ea7\u5168\u5907\u4efd\u7684\u76ee\u5f55\u3002\r\nscp -rp $fullback 192.168.7.101:/fullback    # \u5c06\u5907\u4efd\u7684\u5168\u91cf\u6570\u636e\u4f20\u5230\u53e6\u5916\u4e00\u4e2a\u4e3b\u673a\u4e0a\u3002\r\nfind $fullback/  -ctime +30 -type d -exec rm {} \\;  # \u5220\u9664\u8d85\u8fc730\u5929\u7684\u5907\u4efd\u6570\u636e\u4fe1\u606f\u3002\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1\u6267\u884c\u811a\u672c",children:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1\u6267\u884c\u811a\u672c"}),"\n",(0,a.jsx)(e.p,{children:"\u6bcf\u5468\u65e5\u7684\u51cc\u66684\u70b9\u6267\u884c\u5168\u91cf\u5907\u4efd\u6570\u636e\u5e93"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"[root@centos7 ~]# crontab -e \r\n0 4 * * 0 /root/fullback.sh\n"})}),"\n",(0,a.jsx)(e.h2,{id:"xtrabackup\u589e\u91cf\u5907\u4efd\u811a\u672c",children:"Xtrabackup\u589e\u91cf\u5907\u4efd\u811a\u672c\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:'[root@centos7 ~]# cat incr.sh\r\n#!/bin/bash\r\nuser=root\r\npasswd=centos\r\nDATE=`date +"%Y/%W/%w/%F-%T"`\r\ninc1back=/backup/inc1/$DATE\r\nBASE_DIR=$(tail -1 /backup/full/complete.info | cut -d\\\' -f2) # \u57fa\u4e8e\u5168\u91cf\u5907\u4efd\u7684\u57fa\u7840\u4e0a\uff0c\u5bfc\u5165\u7684complete.info\u6709\u5168\u91cf\u5907\u4efd\u7684\u76ee\u5f55\u8def\u5f84\u4fe1\u606f\uff0c\u5c06\u524d\u9762\u7684\u5168\u91cf\u5907\u4efd\u76ee\u5f55\u63d0\u53d6\u51fa\u6765\u3002\r\n[ ! -d $inc1back ] && mkdir $inc1back  -p # \u5224\u65ad\u76ee\u5f55\u4e0d\u5b58\u5728\u4e3a\u771f\uff0c\u5c31\u521b\u5efa\u65b0\u589e\u76ee\u5f55\r\nxtrabackup  --user=$user   --password=$passwd   --backup  --target-dir=$inc1back       --incremental-basedir=$BASE_DIR # \u6307\u5b9a\u4e0a\u4e00\u4e2a\u5168\u91cf\u5907\u4efd\u76ee\u5f55\u7684\u8def\u5f84\u3002\r\nxtrabackup  --user=$user   --password=$passwd   --prepare  --apply-log-only            --target-dir=$BASE_DIR  # \u6574\u5408\u5168\u91cf\u5907\u4efd\u76ee\u5f55\r\nxtrabackup  --user=$user   --password=$passwd   --prepare  --target-dir=$BASE_DIR --incremental-dir=$inc1back  # \u57fa\u4e8e\u5168\u91cf\u5907\u4efd\u76ee\u5f55\u8fdb\u884c\u6574\u5408\u589e\u91cf\u5907\u4efd\u76ee\u5f55\r\nscp -rp $inc1back  192.168.7.101:/inc1back  # \u5907\u4efd\u5230\u8fdc\u7a0b\u4e3b\u673a\u7684\u76ee\u5f55\u4e0b\r\nfind $inc1back/  -ctime +30 -type d -exec rm {} \\;  # \u5220\u966430\u5929\u4ee5\u524d\u7684\u6570\u636e\n'})}),"\n",(0,a.jsx)(e.h3,{id:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1",children:"\u5b9a\u4e49\u8ba1\u5212\u4efb\u52a1\uff1a"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"[root@centos7 ~]# crontab -e\r\n0 4 * * 0  /root/fullback.sh\r\n0 4 * * 1-6  /root/incr.sh    # \u6bcf\u54681-6\u7684\u51cc\u66684\u70b9\u8fdb\u884c\u589e\u91cf\u5907\u4efd\n"})})]})}function d(r={}){const{wrapper:e}={...(0,s.R)(),...r.components};return e?(0,a.jsx)(e,{...r,children:(0,a.jsx)(o,{...r})}):o(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>t,x:()=>l});var c=n(6540);const a={},s=c.createContext(a);function t(r){const e=c.useContext(s);return c.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function l(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(a):r.components||a:t(r.components),c.createElement(s.Provider,{value:e},r.children)}}}]);